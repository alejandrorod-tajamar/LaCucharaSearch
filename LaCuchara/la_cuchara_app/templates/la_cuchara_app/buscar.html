<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>B√∫squeda - La Cuchara</title>
    <style>
        .resultado {
            margin: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .plato {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
        }
        .promocionado {
            border-left: 3px solid #e67e22;
        }
        .promo-tag {
            color: #e67e22;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>B√∫squeda de Platos</h1>
    
    <form method="post">
        {% csrf_token %}
        <div class="filtros">
            <!-- Campo de b√∫squeda principal -->
            <input type="text" name="query" placeholder="Buscar platos..." value="{{ query }}">
            
            <!-- Filtro por tipo de men√∫ -->
            <select name="tipo_menu">
                <option value="">Todos los tipos</option>
                <option value="sin_restricciones" {% if tipo_menu_selected == "sin_restricciones" %}selected{% endif %}>
                    Sin restricciones
                </option>
                <option value="opciones_celiacos" {% if tipo_menu_selected == "opciones_celiacos" %}selected{% endif %}>
                    Celiacos
                </option>
                <option value="opciones_veganas" {% if tipo_menu_selected == "opciones_veganas" %}selected{% endif %}>
                    Veganos
                </option>
            </select>
            
            <!-- Filtro por valoraci√≥n m√≠nima -->
            <input type="number" name="valoracion_min" 
                   min="0" max="5" step="0.1" 
                   placeholder="Valoraci√≥n m√≠nima"
                   value="{{ valoracion_min|default:'0' }}">
            
            <button type="submit">Buscar</button>
        </div>
    </form>

    {% if resultados %}
        {% for restaurante in resultados %}
            <div class="resultado">
                <h2>{{ restaurante.restaurante }}</h2>
                <p>{{ restaurante.direccion }}</p>
                
                <div class="platos">
                    {% for plato in restaurante.platos|dictsortreversed:"promocion_importe" %}
                        <div class="plato {% if plato.promocion_importe %}promocionado{% endif %}">
                            <h3>{{ plato.nombre }}</h3>
                            {% if plato.promocion_importe %}
                                <span class="promo-tag">üî• Promoci√≥n: {{ plato.promocion_importe }}‚Ç¨</span>
                            {% endif %}
                            <p>Valoraci√≥n: ‚≠ê {{ plato.valoracion|default:"Sin valoraciones" }}</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No se encontraron resultados para "{{ query }}"</p>
    {% endif %}
</body>
</html>